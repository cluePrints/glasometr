<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Bootstrap, from LayoutIt!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

	<!--link rel="stylesheet/less" href="less/bootstrap.less" type="text/css" /-->
	<!--link rel="stylesheet/less" href="less/responsive.less" type="text/css" /-->
	<!--script src="js/less-1.3.3.min.js"></script-->
	<!--append ‘#!watch’ to the browser URL, then refresh the page. -->
	
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap-responsive.min.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-57-precomposed.png">
  <link rel="shortcut icon" href="img/favicon.png">
  
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/scripts.js"></script>
</head>
<body>
<div class="container-fluid">
	<div class="row-fluid">
		<div class="span12">
			<h3>
				Хто з політиків представляє мою думку??
			</h3>
			<table class="table" id="votesTable">
				<thead>
					<tr>
						<th>
							#
						</th>
						<th>
							Проект
						</th>
						<th>
							Ваш вибір
						</th>
						<th>
							Азаров М. .... і тут куча ще їх
						</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>
							1
						</td>
						<td>
							Закон №1
						</td>
						<td>
							<input type="checkbox"/>
						</td>
						<td>
							-
						</td>
					</tr>
					<tr class="success">
						<td>
							1
						</td>
						<td>
							Закон №2
						</td>
						<td>
							<input type="checkbox" checked/>
						</td>
						<td>
							<input type="checkbox" disabled="disabled"/>
						</td>
					</tr>
					<tr class="error">
						<td>
							2
						</td>
						<td>
							Закон №3
						</td>
						<td>
							<input type="checkbox"/>
						</td>
						<td>
							<input type="checkbox" disabled="disabled"/>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>
<script>
	function generateTheadFromData(headers) {
		var fragment = document.createDocumentFragment(),
	    tr, th, i, il, key, checkbox, value;
		var thead = document.createElement('thead');
		fragment.appendChild( thead );
		tr = document.createElement('tr');
		for(i=0,il=headers.length;i<il;i++) {
	        th = document.createElement('th');
	        th.appendChild( document.createTextNode( headers[i] ) );
	        thead.appendChild( th );
		}
		return fragment;
	}
	function generateTbodyFromData(tableData) {
		var fragment = document.createDocumentFragment(),
	    tr, td, i, il, key, checkbox, value;
		var tbody = document.createElement('tbody');
		fragment.appendChild( tbody );
		for(i=0,il=tableData.length;i<il;i++) {
		    tr = document.createElement('tr');
		    for(key in tableData[i]) {
		        td = document.createElement('td');
		        value = tableData[i][key];
		        if (value == 'Refrained' || value == 'WasNotPresent' || value == 'NotVoted') {
		        	value = '-';
		        }		        
		        if (key == 'id' || key == 'title' || value == '-') {
		        	td.appendChild( document.createTextNode( value ) );	
		        } else {
		        	checkbox = document.createElement('input');
		        	checkbox.type = 'checkbox';
		        	if (key.indexOf('p') == 0) {
		        		checkbox.disabled = 'disabled';
		        	}
		        	if (value == 'Yes') {
		        		checkbox.checked = 'true';
		        	}
		        	td.appendChild(checkbox);
		        }
		        tr.appendChild( td );
		    }
		    tbody.appendChild( tr );
		}
		return fragment;
	}
	
	var oopsCallback = function(data){
		alert('Pls refresh page and try once again.');
	};
	
	var okCallback = function(data) {
		var tbodyFragment = generateTbodyFromData(data.billVotes);
		$('#votesTable tbody').replaceWith( tbodyFragment );
		
		var theadFragment = generateTheadFromData(data.headers);
		$('#votesTable thead').replaceWith( theadFragment );	
	}
	
	$.ajax
    ({
        url: '/service/match',
        type: "POST",
        timeout: 3600000
    }).then(okCallback, oopsCallback);
</script>
</body>
</html>
